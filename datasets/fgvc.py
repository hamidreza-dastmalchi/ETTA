import os
from .utils import Datum, DatasetBase, infer_image_type


#template = ['a photo of a {}, a type of aircraft.']
# template = ['a photo of a {}.']
template = [
    "a photo of a flying {}.",
    "a photo of a landing {}.",
    "a photo of a {} on the runway.",
    "a photo of a {} in the sky.",
    "a photo of a parked {}.",
    "a close-up photo of a {} cockpit.",
    "a photo of the tail of a {}.",
    "a photo of a {} during takeoff.",
    "a blurry photo of a {} in motion.",
    "a photo of a {} in an airport hangar.",
    "a photo of a {} in a cloudy sky.",
    "a photo of a {} in a clear blue sky.",
    "a photo of a vintage {}.",
    "a photo of a modern {}.",
    "a photo of a small private {}.",
    "a photo of a large commercial {}.",
    "a photo of a {} with passengers boarding.",
    "a night photo of a {} with its lights on.",
    "a photo of a {} with its engines running.",
    "a photo of a {} flying over mountains.",
    "a photo of a {} flying over water.",
    "a black and white photo of a {}.",
    "a sketch of a {}.",
    "a photo of a crashed {}.",
    "a photo of a {} being refueled.",
    "a photo of a {} during sunrise.",
    "a photo of a {} during sunset.",
    "a photo of a {} in a stormy sky.",
    "a photo of a {} with contrails behind it.",
    "a photo of a {} in a hangar under maintenance.",
    "a photo of a {} with its landing gear down.",
    "a photo of a {} taking off from a grass runway.",
    "a photo of a {} on an aircraft carrier.",
    "a photo of a military {} in action.",
    "a photo of a {} performing aerobatics.",
    "a photo of a {} with its wings folded.",
    "a photo of a cargo {} being loaded.",
    "a photo of a {} with its engines exposed.",
    "a drone view of a {} from above.",
    "a wide-angle photo of multiple {} on a tarmac.",
    "a photo of a {} taxiing on the runway.",
    "a photo of a {} in a snowy airport.",
    "a photo of a {} in a desert airport.",
    "a photo of a {} with birds flying nearby.",
    "a photo of a {} being de-iced in winter.",
    "a photo of a {} at night under runway lights.",
    "a photo of a damaged {} being repaired.",
    "a photo of a {} flying through dense clouds.",
    "a photo of a {} mid-refueling in the air.",
    "a photo of a vintage propeller {}.",
    "a photo of a futuristic concept {}.",
    "a photo of a {} at an airshow.",
    "a photo of a {} being pushed by a tug.",
    "a photo of a {} inside an airport terminal window.",
    "a painting of a {} in flight.",
    "a toy model of a {}.",
    "a photo of a paper model of a {}.",
    "a photo of a {} with colorful airline livery.",
    "a photo of a {} parked on an icy runway.",
    "a close-up photo of a {} wing.",
    "a photo of a {} in the hangar under dim lighting.",
    "a black and white photo of a {} over a city.",
    "a historical photo of a {} from World War II.",
    "a panoramic photo of a {} fleet on the runway.",
    "a blueprint-style drawing of a {}.",
    "a close-up photo of a {} turbine.",
    "a photo of a {} flying over a dense forest.",
    'a bad photo of a {}.',
    'a photo of many {}.',
    'a sculpture of a {}.',
    'a photo of the hard to see {}.',
    'a low resolution photo of the {}.',
    'a rendering of a {}.',
    'graffiti of a {}.',
    'a bad photo of the {}.',
    'a cropped photo of the {}.',
    'a tattoo of a {}.',
    'the embroidered {}.',
    'a photo of a hard to see {}.',
    'a bright photo of a {}.',
    'a photo of a clean {}.',
    'a photo of a dirty {}.',
    'a dark photo of the {}.',
    'a drawing of a {}.',
    'a photo of my {}.',
    'the plastic {}.',
    'a photo of the cool {}.',
    'a close-up photo of a {}.',
    'a black and white photo of the {}.',
    'a painting of the {}.',
    'a painting of a {}.',
    'a pixelated photo of the {}.',
    'a sculpture of the {}.',
    'a bright photo of the {}.',
    'a cropped photo of a {}.',
    'a plastic {}.',
    'a photo of the dirty {}.',
    'a jpeg corrupted photo of a {}.',
    'a blurry photo of the {}.',
    'a photo of the {}.',
    'a good photo of the {}.',
    'a rendering of the {}.',
    'a {} in a video game.',
    'a photo of one {}.',
    'a doodle of a {}.',
    'a close-up photo of the {}.',
    'a photo of a {}.',
    'the origami {}.',
    'the {} in a video game.',
    'a sketch of a {}.',
    'a doodle of the {}.',
    'a origami {}.',
    'a low resolution photo of a {}.',
    'the toy {}.',
    'a rendition of the {}.',
    'a photo of the clean {}.',
    'a photo of a large {}.',
    'a rendition of a {}.',
    'a photo of a nice {}.',
    'a photo of a weird {}.',
    'a blurry photo of a {}.',
    'a cartoon {}.',
    'art of a {}.',
    'a sketch of the {}.',
    'a embroidered {}.',
    'a pixelated photo of a {}.',
    'itap of the {}.',
    'a jpeg corrupted photo of the {}.',
    'a good photo of a {}.',
    'a plushie {}.',
    'a photo of the nice {}.',
    'a photo of the small {}.',
    'a photo of the weird {}.',
    'the cartoon {}.',
    'art of the {}.',
    'a drawing of the {}.',
    'a photo of the large {}.',
    'a black and white photo of a {}.',
    'the plushie {}.',
    'a dark photo of a {}.',
    'itap of a {}.',
    'graffiti of the {}.',
    'a toy {}.',
    'itap of my {}.',
    'a photo of a cool {}.',
    'a photo of a small {}.',
    'a tattoo of the {}.',
    "a photo of a flying {}.",
    "a photo of a landing {}.",
    "a photo of a {} on the runway.",
    "a photo of a {} in the sky.",
    "a photo of a parked {}.",
    "a close-up photo of a {} cockpit.",
    "a photo of the tail of a {}.",
    "a photo of a {} during takeoff.",
    "a blurry photo of a {} in motion.",
    "a photo of a {} in an airport hangar.",
    "a photo of a {} in a cloudy sky.",
    "a photo of a {} in a clear blue sky.",
    "a photo of a vintage {}.",
    "a photo of a modern {}.",
    "a photo of a small private {}.",
    "a photo of a large commercial {}.",
    "a photo of a {} with passengers boarding.",
    "a night photo of a {} with its lights on.",
    "a photo of a {} with its engines running.",
    "a photo of a {} flying over mountains.",
    "a photo of a {} flying over water.",
    "a black and white photo of a {}.",
    "a sketch of a {}.",
    "a photo of a crashed {}.",
    "a photo of a {} being refueled.",
    "a photo of a {} during sunrise.",
    "a photo of a {} during sunset.",
    "a photo of a {} in a stormy sky.",
    "a photo of a {} with contrails behind it.",
    "a photo of a {} in a hangar under maintenance.",
    "a photo of a {} with its landing gear down.",
    "a photo of a {} taking off from a grass runway.",
    "a photo of a {} on an aircraft carrier.",
    "a photo of a military {} in action.",
    "a photo of a {} performing aerobatics.",
    "a photo of a {} with its wings folded.",
    "a photo of a cargo {} being loaded.",
    "a photo of a {} with its engines exposed.",
    "a drone view of a {} from above.",
    "a wide-angle photo of multiple {} on a tarmac.",
    "a photo of a {} taxiing on the runway.",
    "a photo of a {} in a snowy airport.",
    "a photo of a {} in a desert airport.",
    "a photo of a {} with birds flying nearby.",
    "a photo of a {} being de-iced in winter.",
    "a photo of a {} at night under runway lights.",
    "a photo of a damaged {} being repaired.",
    "a photo of a {} flying through dense clouds.",
    "a photo of a {} mid-refueling in the air.",
    "a photo of a vintage propeller {}.",
    "a photo of a futuristic concept {}.",
    "a photo of a {} at an airshow.",
    "a photo of a {} being pushed by a tug.",
    "a photo of a {} inside an airport terminal window.",
    "a painting of a {} in flight.",
    "a toy model of a {}.",
    "a photo of a paper model of a {}.",
    "a photo of a {} with colorful airline livery.",
    "a photo of a {} parked on an icy runway.",
    "a close-up photo of a {} wing.",
    "a photo of a {} in the hangar under dim lighting.",
    "a black and white photo of a {} over a city.",
    "a historical photo of a {} from World War II.",
    "a panoramic photo of a {} fleet on the runway.",
    "a blueprint-style drawing of a {}.",
    "a close-up photo of a {} turbine.",
    "a photo of a {} flying over a dense forest.",
    "a photo of a {} with a clear contrail.",
    "a photo of a {} making a vertical takeoff.",
    "a photo of a {} captured in an infrared image.",
    "a photo of a {} landing in extreme crosswinds.",
    "a photo of a {} with an unusual wing design.",
    "a close-up photo of a {} cockpit instrument panel.",
    "a blueprint-style drawing of a {}."
    ]


class FGVCAircraft(DatasetBase):

    dataset_dir = 'fgvc_aircraft'

    def __init__(self, root):
        
        self.dataset_dir = os.path.join(root, self.dataset_dir)
        self.image_dir = os.path.join(self.dataset_dir, 'images')

        self.template = template

        classnames = []
        with open(os.path.join(self.dataset_dir, 'variants.txt'), 'r') as f:
            lines = f.readlines()
            for line in lines:
                classnames.append(line.strip())
        cname2lab = {c: i for i, c in enumerate(classnames)}

        test = self.read_data(cname2lab, 'images_variant_test.txt')
        
        
        super().__init__(test=test)
    
    def read_data(self, cname2lab, split_file):
        filepath = os.path.join(self.dataset_dir, split_file)
        items = []
        
        with open(filepath, 'r') as f:
            lines = f.readlines()
            for line in lines:
                line = line.strip().split(' ')
                imname = line[0] + '.jpg'
                classname = ' '.join(line[1:])
                impath = os.path.join(self.image_dir, imname)
                label = cname2lab[classname]
                item = Datum(
                    impath=impath,
                    label=label,
                    classname=classname
                )
                items.append(item)
        
        return items